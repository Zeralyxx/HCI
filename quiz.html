<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <title>MindBlast | Quiz</title>
  <style>
    :root {
      --bg-light: #f0f2f5;
      --white: #ffffff;
      --gray: #e0e0e0;
      --green: #d2f6d2;
      --red: #f8d2d2;
      --rounded: 20px;
      --shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      --primary-font: 'Segoe UI', sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: var(--primary-font);
      margin: 0;
      background: linear-gradient(135deg, #2E0B40, #3E1A58, #4E2A70);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      padding: 16px;
    }

    #start-screen, #quiz-screen {
      background: var(--white);
      padding: 24px;
      border-radius: var(--rounded);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 420px;
      text-align: center;
      transition: all 0.3s ease;
    }

    #quiz-screen {
      display: none;
      flex-direction: column;
      gap: 16px;
    }

    h1, h2 {
      margin-bottom: 16px;
    }

    .btn {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: none;
      border-radius: var(--rounded);
      font-size: 16px;
      cursor: pointer;
      background-color: var(--gray);
      transition: background 0.3s ease;
    }

    .btn span {
      font-size: 20px;
      vertical-align: middle;
      margin-right: 8px;
    }

    .btn:hover {
      background-color: #d0d0d0;
    }

    .option {
      background: var(--gray);
      transition: background 0.3s ease;
    }

    .correct {
      background-color: var(--green) !important;
    }

    .incorrect {
      background-color: var(--red) !important;
    }

    #icon-placeholder {
      font-size: 60px;
      background: #ccc;
      border-radius: var(--rounded);
      padding: 20px;
      width: 100px;
      height: 100px;
      color: #333;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #progress {
      font-weight: bold;
      margin-top: 12px;
    }

    @media (max-width: 480px) {
      #start-screen, #quiz-screen {
        padding: 16px;
      }

      .btn {
        font-size: 14px;
        padding: 10px;
      }
    }
  </style>
</head>
<body>

  <div id="start-screen">
    <h1>Start Quiz</h1>
    <p>Select difficulty:</p>
    <button class="btn " id="easyb">ðŸŸ¢ Easy</button>
    <button class="btn " id="normalb">ðŸŸ¡ Normal</button>
    <button class="btn " id="hardb">ðŸ”´ Hard</button>
  </div>

  <div id="quiz-screen">
    <h2>What is this icon?</h2>
    <div id="icon-placeholder">ðŸ”²</div>
    <div id="options">
      <!-- Answer buttons injected here -->
    </div>
    <div id="progress">1/10</div>
  </div>
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAZLZPVAlZUJWLturWzJ3nqyceZbSIevl4",
    authDomain: "mindblast-icons.firebaseapp.com",
    projectId: "mindblast-icons",
    storageBucket: "mindblast-icons.firebasestorage.app",
    messagingSenderId: "807795058423",
    appId: "1:807795058423:web:2066a5d149852a43af55f2",
    measurementId: "G-LSJ3SWQP6M"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const analytics = getAnalytics(app);

  let quizData = [];
  let currentQuestion = 0;
  let score = 0;

  const startScreen = document.getElementById("start-screen");
  const quizScreen = document.getElementById("quiz-screen");
  const iconPlaceholder = document.getElementById("icon-placeholder");
  const optionsDiv = document.getElementById("options");
  const progressText = document.getElementById("progress");

  async function startQuiz(difficulty) {
    quizData = await loadQuestions(difficulty);
    currentQuestion = 0;
    score = 0;
    startScreen.style.display = "none";
    quizScreen.style.display = "flex";
    showQuestion();
  }

  async function loadQuestions(difficulty) {
    const colRef = collection(db, difficulty.charAt(0).toUpperCase() + difficulty.slice(1));
    const snapshot = await getDocs(colRef);
    let questions = [];

    snapshot.forEach(doc => {
      const data = doc.data();
      questions.push({
        icon: `<span class="material-symbols-outlined">${data.icon}</span>`,
        options: shuffleArray([...data.options]), // clone then shuffle
        answer: data.answer
      });
    });

    return shuffleArray(questions).slice(0, 10); // take 10 random questions
  }

  function shuffleArray(array) {
    return array.sort(() => Math.random() - 0.5);
  }

  function showQuestion() {
    const q = quizData[currentQuestion];
    iconPlaceholder.innerHTML = q.icon;
    optionsDiv.innerHTML = "";
    progressText.textContent = `${currentQuestion + 1}/10`;

    q.options.forEach(option => {
      const btn = document.createElement("button");
      btn.classList.add("btn", "option");
      btn.textContent = option;
      btn.onclick = () => checkAnswer(btn, q.answer);
      optionsDiv.appendChild(btn);
    });
  }

  function checkAnswer(selectedBtn, correctAnswer) {
    const buttons = document.querySelectorAll(".option");
    buttons.forEach(btn => {
      btn.disabled = true;
      if (btn.textContent === correctAnswer) {
        btn.classList.add("correct");
      } else {
        btn.classList.add("incorrect");
      }
    });

    if (selectedBtn.textContent === correctAnswer) {
      score++;
    }

    setTimeout(() => {
      currentQuestion++;
      if (currentQuestion < quizData.length) {
        showQuestion();
      } else {
        showScore();
      }
    }, 1000);
  }

  function showScore() {
    setTimeout(() => {
      if (confirm(`ðŸŽ‰ Quiz Complete!\nYou scored ${score} out of 10\n\nTry again?`)) {
        location.reload();
      } else {
        startScreen.style.display = "block";
        quizScreen.style.display = "none";
      }
    }, 200);
  }

  // Inject random icons from Firestore into the difficulty buttons
  async function setDifficultyIcons() {
    const difficulties = ["Easy", "Normal", "Hard"];
    for (let diff of difficulties) {
      const colRef = collection(db, diff);
      const snapshot = await getDocs(colRef);
      const docs = snapshot.docs;
      const randomDoc = docs[Math.floor(Math.random() * docs.length)];
      const iconName = randomDoc.data().icon;
      document.getElementById(`${diff.toLowerCase()}-btn-icon`).textContent = iconName;
    }
  }

  window.onload = setDifficultyIcons;
  document.getElementById("easyb").addEventListener("click", () => startQuiz("easy"));
  document.getElementById("normalb").addEventListener("click", () => startQuiz("normal"));
  document.getElementById("hardb").addEventListener("click", () => startQuiz("hard"));
</script>
</body>
</html>
