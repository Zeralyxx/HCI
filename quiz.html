<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <title>MindBlast | Quiz</title>
  <style>
    :root {
      --bg-light: #f0f2f5;
      --white: #ffffff;
      --gray: #e0e0e0;
      --green: #d2f6d2;
      --red: #f8d2d2;
      --rounded: 20px;
      --shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      --primary-font: 'Segoe UI', sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: var(--primary-font);
      margin: 0;
      background: linear-gradient(135deg, #2E0B40, #3E1A58, #4E2A70);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      padding: 16px;
    }

    #start-screen, #quiz-screen {
      background: var(--white);
      padding: 24px;
      border-radius: var(--rounded);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 420px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
    }

    #quiz-screen {
      display: none;
      flex-direction: column;
      gap: 16px;
    }

    h1, h2 {
      margin-bottom: 16px;
    }

    .btn {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: none;
      border-radius: var(--rounded);
      font-size: 16px;
      cursor: pointer;
      background-color: var(--gray);
      transition: background 0.3s ease;
    }

    .btn span {
      font-size: 20px;
      vertical-align: middle;
      margin-right: 8px;
    }

    .btn:hover {
      background-color: #d0d0d0;
    }

    .option {
      background: var(--gray);
      transition: background 0.3s ease;
    }

    .correct {
      background-color: var(--green) !important;
    }

    .incorrect {
      background-color: var(--red) !important;
    }

    #icon-placeholder {
      font-size: 60px;
      background: #ccc;
      border-radius: var(--rounded);
      padding: 20px;
      width: 100px;
      height: 100px;
      color: #333;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #progress {
      font-weight: bold;
      margin-top: 12px;
    }

    #timer {
      position: absolute;
      top: 16px;
      right: 24px;
      font-weight: bold;
      color: #333;
    }

    @media (max-width: 480px) {
      #start-screen, #quiz-screen {
        padding: 16px;
      }

      .btn {
        font-size: 14px;
        padding: 10px;
      }

      #timer {
        top: 12px;
        right: 16px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

  <div id="start-screen">
    <h1>Start Quiz</h1>
    <p>Select difficulty:</p>
    <button class="btn" id="easy-btn-icon">üü¢ Easy</button>
    <button class="btn" id="medium-btn-icon">üü° Medium</button>
    <button class="btn" id="hard-btn-icon">üî¥ Hard</button>
  </div>

  <div id="quiz-screen">
    <div id="timer">‚è±Ô∏è 60s</div>
    <h2>What is this icon?</h2>
    <div id="icon-placeholder">üî≤</div>
    <div id="options"></div>
    <div id="progress">1/10</div>
  </div>

  <script type="module">
    import {
      initializeApp
    } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      serverTimestamp,
      query,
      where,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";
    import {
      getAnalytics
    } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-analytics.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAZLZPVAlZUJWLturWzJ3nqyceZbSIevl4",
      authDomain: "mindblast-icons.firebaseapp.com",
      projectId: "mindblast-icons",
      storageBucket: "mindblast-icons.firebasestorage.app",
      messagingSenderId: "807795058423",
      appId: "1:807795058423:web:2066a5d149852a43af55f2",
      measurementId: "G-LSJ3SWQP6M"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const analytics = getAnalytics(app);

    let quizData = [];
    let currentQuestion = 0;
    let score = 0;
    let correctAnswers = 0;
    let difficulty = '';
    let questionStartTime = 0;
    let timeRemaining = 60;
    let timerInterval;

    const startScreen = document.getElementById("start-screen");
    const quizScreen = document.getElementById("quiz-screen");
    const iconPlaceholder = document.getElementById("icon-placeholder");
    const optionsDiv = document.getElementById("options");
    const progressText = document.getElementById("progress");
    const timerDisplay = document.getElementById("timer");

    async function startQuiz(diff) {
      difficulty = diff;
      quizData = await loadQuestions(diff);
      currentQuestion = 0;
      score = 0;
      correctAnswers = 0;
      startScreen.style.display = "none";
      quizScreen.style.display = "flex";
      startTimer();
      showQuestion();
    }

    async function loadQuestions(difficulty) {
      const colRef = collection(db, difficulty.charAt(0).toUpperCase() + difficulty.slice(1));
      const snapshot = await getDocs(colRef);
      let questions = [];

      snapshot.forEach(doc => {
        const data = doc.data();
        questions.push({
          icon: `<span class="material-symbols-outlined">${data.icon}</span>`,
          options: shuffleArray([...data.options]),
          answer: data.answer
        });
      });

      return shuffleArray(questions).slice(0, 10);
    }

    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function startTimer() {
      timeRemaining = 60;
      timerDisplay.textContent = `‚è±Ô∏è ${timeRemaining}s`;
      timerInterval = setInterval(() => {
        timeRemaining--;
        timerDisplay.textContent = `‚è±Ô∏è ${timeRemaining}s`;
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          alert("‚è∞ Time's up! You failed the quiz.");
          location.reload();
        }
      }, 1000);
    }

    function showQuestion() {
      const q = quizData[currentQuestion];
      iconPlaceholder.innerHTML = q.icon;
      optionsDiv.innerHTML = "";
      progressText.textContent = `${currentQuestion + 1}/10`;
      questionStartTime = Date.now();

      q.options.forEach(option => {
        const btn = document.createElement("button");
        btn.classList.add("btn", "option");
        btn.textContent = option;
        btn.onclick = () => checkAnswer(btn, q.answer);
        optionsDiv.appendChild(btn);
      });
    }

    function checkAnswer(selectedBtn, correctAnswer) {
      const timeTaken = (Date.now() - questionStartTime) / 1000;

      const buttons = document.querySelectorAll(".option");
      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === correctAnswer) {
          btn.classList.add("correct");
        } else {
          btn.classList.add("incorrect");
        }
      });

      if (selectedBtn.textContent === correctAnswer) {
        correctAnswers++;
        let multiplier = 0;

        if (difficulty === "Easy") {
          if (timeTaken <= 15) multiplier = 1.5;
          else if (timeTaken <= 40) multiplier = 1.0;
          else if (timeTaken <= 60) multiplier = 0.5;
        } else if (difficulty === "Medium") {
          if (timeTaken <= 15) multiplier = 2.5;
          else if (timeTaken <= 40) multiplier = 2.0;
          else if (timeTaken <= 60) multiplier = 1.5;
        } else if (difficulty === "Hard") {
          if (timeTaken <= 15) multiplier = 4;
          else if (timeTaken <= 40) multiplier = 3;
          else if (timeTaken <= 60) multiplier = 2;
        }

        if (multiplier === 0) {
          alert("‚è±Ô∏è Too slow! You failed the question.");
        } else {
          score += Math.round(10 * multiplier);
        }
      }

      setTimeout(() => {
        currentQuestion++;
        if (currentQuestion < quizData.length) {
          showQuestion();
        } else {
          clearInterval(timerInterval);
          showScore();
        }
      }, 1000);
    }

    async function showScore() {
      setTimeout(async () => {
        const playerName = prompt(`üéâ Quiz Complete!\nYou scored ${score}.\nCorrect Answers: ${correctAnswers}\n\nEnter your name for the leaderboard:`);

        if (playerName) {
          await uploadToLeaderboard(playerName.trim(), score, correctAnswers, difficulty);
          alert("‚úÖ Your score has been uploaded to the leaderboard!");
        }

        if (confirm("Try again?")) {
          location.reload();
        } else {
          startScreen.style.display = "block";
          quizScreen.style.display = "none";
        }
      }, 200);
    }

    async function uploadToLeaderboard(name, score, correct, difficulty) {
      const leaderboardRef = collection(db, "Leaderboard");

      const q = query(leaderboardRef, where("name", "==", name));
      const snapshot = await getDocs(q);

      if (!snapshot.empty) {
        const docRef = snapshot.docs[0].ref;
        const data = snapshot.docs[0].data();

        await updateDoc(docRef, {
          score: (data.score || 0) + score,
          correct: (data.correct || 0) + correct,
          quizzesCompleted: (data.quizzesCompleted || 0) + 1,
          lastPlayed: serverTimestamp()
        });
      } else {
        await addDoc(leaderboardRef, {
          name,
          score,
          correct,
          difficulty,
          quizzesCompleted: 1,
          timestamp: serverTimestamp()
        });
      }
    }

    const emojiMap = {
      Easy: "üü¢",
      Medium: "üü°",
      Hard: "üî¥"
    };

    const buttonIdMap = {
      Easy: "easy-btn-icon",
      Medium: "medium-btn-icon",
      Hard: "hard-btn-icon"
    };

    async function setDifficultyIcons() {
      const difficulties = ["Easy", "Medium", "Hard"];
      for (let diff of difficulties) {
        const colRef = collection(db, diff);
        const snapshot = await getDocs(colRef);
        const docs = snapshot.docs;
        const randomDoc = docs[Math.floor(Math.random() * docs.length)];
        const iconName = randomDoc.data().icon;
        document.getElementById(emojiMap[diff]).innerHTML = `
          ${emojiMap[diff]} <span class="material-symbols-outlined">${iconName}</span> ${diff}`;
      }
    }

    window.onload = setDifficultyIcons;
    document.getElementById("easy-btn-icon").addEventListener("click", () => startQuiz("Easy"));
    document.getElementById("medium-btn-icon").addEventListener("click", () => startQuiz("Medium"));
    document.getElementById("hard-btn-icon").addEventListener("click", () => startQuiz("Hard"));
  </script>
</body>
</html>
